<!DOCTYPE html>
<head>  
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Odyssey ExoMars</title>
  <!-- call css styles -->
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
  <link rel="stylesheet" href="http://cartodb.github.io/odyssey.js/sandbox/css/slides.css"/> 
  <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.11/themes/css/cartodb.css" />
  <link rel="stylesheet" href="http://azavea.github.io/Leaflet.zoomdisplay/css/leaflet.zoomdisplay.css" />
  <!-- call javascript libraries -->
  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="http://libs.cartocdn.com/cartodb.js/v3/3.13/cartodb.core.js"></script>
  <script src="http://libs.cartocdn.com/cartodb.js/v3/3.11/cartodb.js"></script>
  <script src="http://azavea.github.io/Leaflet.zoomdisplay/js/leaflet.zoomdisplay.js"></script>
  <script src="http://cartodb.github.io/odyssey.js/dist/odyssey.js" charset="UTF-8"></script>
  		
  <style>
	
	#map{
		width: 100%; 
		height: 100%;
	} 
	
	.leaflet-left .leaflet-control-scale {
		margin-left: 5px;
	}
	.leaflet-bottom .leaflet-control-scale {
		margin-bottom: 40px;
	}
	
    .leaflet-control-scale-line {
		-moz-box-sizing: content-box;
		box-sizing: content-box;
		border: 3px solid #000000;
		border-top: none;
		
	}
    #menu_options { 
    	position:absolute;
    	top:40px;
    	right:10px;
    	width:200px;
    	height: 220px;
    	z-index:10;
    	padding-top:10px;
    	background-color:#ffc966;
    	border-radius: 25px;
    	border: 3px solid #fff;
    	opacity: 0.7;
    }
    #menu_options h3{ 
    	text-align: center;
    	font-family:"AleoBold";
    		
    }
    
    #menu_options ul {
    	text-align: left;
  		display: block;
  		font-family:'Hoefler Text', Georgia, 'Times New Roman', serif;
    }
    #menu_options ul li{
    	float: left;
    	list-style: none;
    	text-align: center;
    	margin-right: 50px;
    	width: 200px;
    	line-height: 30px;
    }
    #menu_options ul li:hover > ul {
  		display: block;
 		opacity: 1;
  		visibility: visible;
	}
    #menu_options ul li a{
    	text-decoration: none;
    	color: #000000;
    	display: block;
    	width: 100%;
    	padding: 2px 0px 2px 0px;
    	background-color: #ffc966; 	
	}
	#menu_options ul li a:hover{
    	text-decoration: none;
    	color: #FFF;
    	background-color:#1A62A3;		
    }
    
    #menu_options ul li ul{
  		position: relative;
  		width: auto;
  		height: auto;
   		display: none;
  		visibility: hidden;
 	}
	#menu_options ul li ul li a{ 
  		background-color: #F7F6F4; 
  		color: #000000;
  		border-radius: 5px;
	}
	#menu_options ul li ul li a:hover{ 
  		background-color: #d7e9f9; 
  		display: block; 
  		color: red;
	}
	
	
	#menu_options ul li  ul li ul{
		position: relative;
  		width: auto;
  		height: auto;
   		display: none;
  		visibility: hidden;
	}
	#menu_options ul li ul li ul > li{
		text-decoration: none;
    	color: white;
    	background-color:#1A62A3;
	}
	#menu_options ul li ul li ul li > a{
		background-color:  #f9fcfe; 	 
  		color: #000000;
  		border-radius: 5px;
	}
	#menu_options ul li ul li ul li > a:hover{
		background-color: #e8f2fb; 
  		display: block; 
  		color: blue;
  		visibility: visible;
	}
	
	#slides_container {
    	display:block;
    	position:absolute;
    	font-family:'Hoefler Text', Georgia, 'Times New Roman', serif;
    	top:40px;
    	left:40px;
    	opacity: 0.7;
    	background-color:#ffc966;
    	z-index:100;
    	border-radius: 25px;
    	border: 3px solid #fff;
    }
   
   
  </style>
</head>
<body>
<!-- define element with id = map -->
	<div id = "map"></div> 
		<!-- define buttons-->
	<div id = "menu_options">
		<h3>Drop-down menu</h3>
		<hr>
		<ul>
			<li><a href ="#">Base maps</a>
				<ul>
   					<li><a href="#MOLA" id="MOLA" class="button MOLA">MOLA</a></li>
   					<li><a href="#MOLA_color" id="MOLA_color" class="button MOLA_color">MOLA Color</a></li>
   				</ul>
   				</li>
   			<li><a href ="#">Hrsc Images</a>
				<ul>
   					<li><a href="#hrscAram" id="hrscAram" class="button hrscAram">Hrsc Aram Dorsum</a></li>
   					<li><a href="#hrscHypanis" id="hrscHypanis" class="button hrscHypanis">Hrsc Hypanis Vallis</a></li>
   					<li><a href="#hrscOxia" id="hrscOxia" class="button hrscOxia">Hrsc Oxia Planum</a></li>
   					<li><a href="#hrscMawrth" id="hrscMawrth" class="button hrscMawrth">Hrsc Mawrth Vallis</a></li>
   				</ul>
   			</li>
   			<li><a href ="#">HiRISE Images</a>
   				<ul>
   					<li><a href="#HiRISEOxia" id="HiRISEOxia" class="button HiRISEOxia">HiRISE Oxia Planum</a></li>
   				 	<li><a href="#HiRISEMawrth" id="HiRISEMawrth" class="button HiRISEMawrth">HiRISE Mawrth Vallis</a></li>
   				 </ul>
   			</li>
			<li><a href ="#">Constraints</a>
				<ul>
   					<li><a href="#constraint1" id="constraint1" class="button constraint1">Latitude constraint</a></li>
   				</ul>
   			</li>
   			<li><a href ="#">Landing sites</a>
   				 <ul>
   				 	<li class = "submenu"><a href ="#">Aram Dorsum</a>
   				 		<ul>
   				 			<li><a href="#ellipses1" id="ellipses1" class="button ellipses1">Landing 2018</a></li>
   				 			<li><a href="#ellipses5" id="ellipses5" class="button ellipses5">Landing 2020</a></li>
   				 		</ul>	
   				 	</li>
   				 	<li class = "submenu"><a href ="#">Hypanis Vallis</a>
   				 		<ul>
   				 			<li><a href="#ellipses2" id="ellipses2" class="button ellipses2">Landing 2018</a></li>
   				 			<li><a href="#ellipses6" id="ellipses6" class="button ellipses6">Landing 2020</a></li>
   				 		</ul>	
   				 	</li>
   				 	<li class = "submenu"><a href ="#">Oxia Planum</a>
   				 		<ul>
   				 			<li><a href="#ellipses3" id="ellipses3" class="button ellipses3">Landing 2018</a></li>
   				 			<li><a href="#ellipses7" id="ellipses7" class="button ellipses7">Landing 2020</a></li>
   				 		</ul>	
   				 	</li>
   				 	<li class = "submenu"><a href ="#">Mawrth Vallis</a>
   				 		<ul>
   				 			<li><a href="#ellipses4" id="ellipses4" class="button ellipses4">Landing 2018</a></li>
   				 			<li><a href="#ellipses8" id="ellipses8" class="button ellipses8">Landing 2020</a></li>
   				 		</ul>	
   				 	</li>
   				 </ul>
  			</li>
  			
  		</ul>	
   	</div>
  		<!-- define element with id = slides -->
	<div id = "slides_container">
			<div id = "slides">
				<!-- SLIDE #0 -->
				<div class="slide">
					<h1>Introduction to ExoMars 2018</h1>
					<p>ExoMars is a joint two-mission endeavour between ESA and Russia's Roscosmos space agency. The Trace Gas Orbiter and an entry, descent and landing demonstrator module, Schiaparelli, will be launched in January 2016, arriving at Mars nine months later. The Rover and Surface Platform will depart in May 2018, with touchdown on Mars in January 2019.</p>
					<p>The ExoMars programme's scientific objectives are: </br></br> 1. To search for signs of past and present life on Mars </br>2. To investigate the water/geochemical environment as a function of depth in the shallow subsurface </br>3. To study martian atmospheric trace gases and their sources </br>4. To characterise the surface environment</p>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #1 -->
				<div class="slide">
					<h1>MOLA</h1>
					<p>The Mars Orbiter Laser Altimeter (MOLA), is an instrument on the Mars Global Surveyor (MGS), a spacecraft that was launched on November 7, 1996. MGS carried a laser altimeter on board to determinate the height of surface on Mars</p>
					<p>MOLA collected altimetry data until June 30,2001. Then it operated as a radiometer until October 7, 2006.</p>
					<p>Click here to change from gray to  color MOLA map.</p>
					<div style="padding-top:10px;margin-left: 70px;text-align: center;width:150px; background-color: #FFF; color: #000000; border: 1px solid #000000;"><a href="#MOLA" id="MOLA" class="button MOLA">MOLA Grayscale</a></div><div style="padding-top:10px;margin-left: 70px;text-align: center;width:150px; background-color: #FFF; color: #000000; border: 1px solid #000000;"><a href="#MOLA_color" id="MOLA_color" class="button MOLA_color">MOLA Color</a></div>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #1.1 -->
				<div class="slide">
					<h1>Landing Site Selection Working Group</h1>
					<p>During October 2013, the European Space Agency (ESA) and the Space Reasearch Institute of the Russian Academy of Sciences (IKI) [on behalf of the Russian Federal Space Agency (Roscosmos)], agreed to appoint a Landing Site Selection Working Group (LSSWG) to make recommendation to the agencies regarding landing sites for the ExoMars 2018 mission.</p>
					<p>The final landing site(s) recommendation for the 2018 mission will be produced by the LSSWG prior ro the mission's Flight Acceptance Review (FAR), currently planned on October 2017. This recommendation will be delivered to ESA's Director of Science and Robotic Exploration and the appropriate Russian authorities. Roscosmos and ESA will the follow the applicable approval procedure with their Governing Bodies</p>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #1.2 -->
				<div class="slide">
					<h1>Mars Landing Sites</h1>
					<p>At first, eight landing sites were proposed:</p> <ul><li>Mawrth Vallis 1</li><li>Mawrth Vallis 2<li><li>Oxia Planum 1</li><li>Oxia Planum 2</li><li>Coogoon Valles</li><li>Hypanis Vallis</li><li>Simud Vallis</li><li>Aram Dorsum</li><li>Southern Isidis</li></ul>
					</br>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #2 -->
				<div class="slide">
					<h1>Aram Dorsum 2018</h1>
					<p>It is the highest and the closest site to the Martian equator</p>
					<p>The Aram Dorsum site receives its name from the Aram Dorsum channel, curving from northeast to west across the landing location. The sedimentary rocks around the channel are interpreted to be alluvial sediments deposited much like those around Earth's River Nile.</p>
					<p>The High Resolution Stereo Camera (HRSC) is a camera experiment on Mars Express.At an altitude of 250 km from Mars, HRSC can produce images with a resolution of 2.3 meters/pixel of 2.35 kilometers square Mars Terrain</p>
					<p>Click the button to see the difference between MOLA and HRSC resolution</p>
					<div style="padding-top:10px;left: 50px;text-align: center;width:150px; background-color: #FFF; color: #000000"><a href="#hrscAram" id="hrscAram" class="button hrscAram">Hrsc Aram Dorsum</a></div>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #3 -->
				<div class="slide">
					<h1>Aram Dorsum 2020</h1>
					<p>It is the highest and the closest site to the Martian equator</p>
					<p>The Aram Dorsum site receives its name from the Aram Dorsum channel, curving from northeast to west across the landing location. The sedimentary rocks around the channel are interpreted to be alluvial sediments deposited much like those around Earth's River Nile.</p>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #4 -->
				<div class="slide">
					<h1>Hypanis Vallis 2018</h1>
					<p>Hypanis Vallis is one of several valleys situated between two large outflow channels, Maja Vallis in the west and Shalbatana Vallis in the east.</p>
					<p>The valleys are thought to have been formed by groundwater seepage or surface runoff. Several of the valleys, including Hypanis Vallis, have fan-shaped deposits at their termini. These fluvial deposits are interpreted as the remnants of a delta that formed in a lake. They are characterised by distinct layering at their margins, providing access to the various sedimentary layers.</p>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #5 -->
				<div class="slide">
					<h1>Hypanis Vallis 2020</h1>
					<p>Hypanis Vallis is one of several valleys situated between two large outflow channels, Maja Vallis in the west and Shalbatana Vallis in the east.</p>
					<p>The valleys are thought to have been formed by groundwater seepage or surface runoff. Several of the valleys, including Hypanis Vallis, have fan-shaped deposits at their termini. These fluvial deposits are interpreted as the remnants of a delta that formed in a lake. They are characterised by distinct layering at their margins, providing access to the various sedimentary layers.</p>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #6 -->
				<div class="slide">
					<h1>Oxia Planum 2018</h1>
					<p>The region is characterised by ancient highland cratered terrains that become increasingly eroded towards the highland-lowland boundary.</p>
					<p>The candidate landing site area in Oxia Planum is located inside a shallow basin, at the outlet of the Coogoon Valles system. The region was chosen to include extensive, layered exposures rich in iron and magnesium phyllosilicates.</p>
					<p>The main scientific concern for this site relates to the lack of precise information regarding the geologic context and origin of the clay-bearing unit. However, the phyllosilicate deposits are seen as the key to the study of aqueous activity on early Mars and the search for evidence of habitable environments early in the planet’s history.</p>
					<p>Click the button to see the difference between HRSC and HiRISE resolution</p>
					<div style="padding-top:10px;left: 50px;text-align: center;width:150px; background-color: #FFF; color: #000000"><a href="#HiRISEOxia" id="HiRISEOxia" class="button HiRISEOxia">HiRISE Oxia Planum</a></div>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #7 -->
				<div class="slide">
					<h1>Oxia Planum 2020</h1>
					<p>The region is characterised by ancient highland cratered terrains that become increasingly eroded towards the highland-lowland boundary.</p>
					<p>The candidate landing site area in Oxia Planum is located inside a shallow basin, at the outlet of the Coogoon Valles system. The region was chosen to include extensive, layered exposures rich in iron and magnesium phyllosilicates.</p>
					<p>The main scientific concern for this site relates to the lack of precise information regarding the geologic context and origin of the clay-bearing unit. However, the phyllosilicate deposits are seen as the key to the study of aqueous activity on early Mars and the search for evidence of habitable environments early in the planet’s history.</p>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #8-->
				<div class="slide">
					<h1>Mawrth Vallis 2018</h1>
					<p>This area contains a large outflow channel known as Mawrth Vallis, which once discharged huge amounts of water onto the northern plains. The proposed ExoMars landing site is situated just south of this channel.</p>
					<p>The region surrounding Mawrth Vallis contains one of the largest exposures of phyllosilicates (clay minerals produced by chemical weathering) detected on Mars. These deposits provide a unique opportunity to evaluate aqueous activity on early Mars and point to the possibility that habitable environments may have existed during the Noachian period (from the formation of the planet to perhaps 3.6 billion years ago). Other deposits and outcrops in the region show the highest degree of mineral alteration identified so far on Mars.</p>
					<p>Click the right button to learn more !</p>
				</div>
				<!-- SLIDE #9-->
				<div class="slide">
					<h1>Mawrth Vallis 2020</h1>
					<p>This area contains a large outflow channel known as Mawrth Vallis, which once discharged huge amounts of water onto the northern plains. The proposed ExoMars landing site is situated just south of this channel.</p>
					<p>The region surrounding Mawrth Vallis contains one of the largest exposures of phyllosilicates (clay minerals produced by chemical weathering) detected on Mars. These deposits provide a unique opportunity to evaluate aqueous activity on early Mars and point to the possibility that habitable environments may have existed during the Noachian period (from the formation of the planet to perhaps 3.6 billion years ago). Other deposits and outcrops in the region show the highest degree of mineral alteration identified so far on Mars.</p>
					<p>Click the right button to learn more !</p>
				</div>	
				<!-- SLIDE #10 -->
				<div class="slide">
					<h1>The End</h1>
					<p>Great explanation inside this chapter</br>with some incredible images and data</p>
				</div>			
			</div>
		<ul id="navButtons">
			<li><a class = "prev"></a></li>
			<li><a class = "next"></a></li>		
	    </ul>	
	</div>
<script>
	var app =  {};
	// 2. define ExoMars object. The value of the property is a function.
	app.exomars = (function(w,d,$,O){
			// define object that have all the elements and layers 
			var el = {
				map: null,
				basemap: null, // MOLA basemap grey_scale
				basemapColor: null,
				story: null,
				hirise: null,
				hrsc: null,
				tileLayerAramHiRISE: null, 
				tileLayerAramHrsc: null,
				tileLayerHypanisHiRISE: null, 
				tileLayerHypanisHrsc: null,
				tileLayerMawrthHrsc: null,
				tileLayerMawrthHiRISE: null,
				tileLayerOxiaHrsc: null,
				tileLayerOxiaHiRISE: null,
				// landing sites
				Aram: null,
				Hypanis:null,
				Oxia: null,
				Mawrth: null,
				// center of the landingSite
				center: null,
				// CartoDB layers
				landingSite: null,
				latConstraint: null,
				ellipses: null,
				ellipses1: null,
				ellipses2: null,
				ellipses3: null,
				ellipses4: null,
				ellipses5: null,
				ellipses6: null,
				ellipses7: null,
				ellipses8: null,
				LayerActions: null
				
			};
			// 	define function that initiates the map element
			var initMap = function(){
				// define map
				el.map =  new L.Map('map', { 
      				center: [15,-11],
      				zoom: 3,
      				minZoom: 3,
      				zoomControl: false
      			}); 
      			new L.control.zoom({position : 'bottomright'}).addTo(el.map);		
    			new L.control.scale({metric: true,imperial: false}).addTo(el.map);
    			// define basemap
    			el.basemap = new L.tileLayer('http://gislab.esac.esa.int/data/whereonmars/tiles/mola-gray/{z}/{x}/{y}.png', {
 					attribution: 'GISLAB',
 					tms:true,
 					maxNativeZoom: 9,
  				}).addTo(el.map).setZIndex(0);
				// define color basemap 
  				el.basemapColor = new L.tileLayer('http://gislab.esac.esa.int/data/whereonmars/tiles/mola-color/{z}/{x}/{y}.png', {
 					attribution: 'GISLAB',
 					maxNativeZoom: 7,
  				}).setZIndex(0);
  				
  				// define overlays from cartodb database
  				var sql = new cartodb.SQL({ user: 'whereonmars'});
		 		sql.execute("SELECT * FROM overlays_table")
		 		.done(function(data){
		 			el.hrsc = {};
		 			el.hirise = {};
		 			// loop that read each row of cartodb table and add each hrsc layer 
       				for (i = 0; i < data.total_rows; i++){
      					if (i < 4){
      						el.hrsc[i]= L.tileLayer(data.rows[i].url,{
  								tms:true,
  								minZoom: 7,
  								opacity: 0.5, 			
  								unloadInvisibleTiles: true, // If true, all the tiles that are not visible after panning are removed 
  								updateWhenIdle: false, // If false, new tiles are loaded during panning, otherwise only after it (when true)
  								maxNativeZoom: 10
								}).setZIndex(1);	
									if(i > 0){
										el.hrsc[i].addTo(el.map);
									}; 	
      					} else {
      						el.hirise[i] = new L.tileLayer(data.rows[i].url,{
 								tms:true,
 								opacity: 0.5,
 								minZoom: 9,
 								unloadInvisibleTiles: true, // If true, all the tiles that are not visible after panning are removed 
  								updateWhenIdle: true, // If false, new tiles are loaded during panning, otherwise only after it (when true)
 								maxNativeZoom: 18
							}).setZIndex(2);
      							if(i > 4){
									el.hirise[i].addTo(el.map);
								};
      					}		
      				}
      			});
				el.Aram = new L.LatLng(7.87, -11.2);
				el.Hypanis = new L.LatLng(11.8, -45.04);
				el.Oxia = new L.LatLng(18.2, -24.55);
				el.Mawrth = new L.LatLng(22.16, -17.95);
				el.center = new L.LatLng(15,-11);
			}
	  		// call data from cartoDB 
	  		var cartodbData = function(){
				var layerURL = 'http://whereonmars.cartodb.com/api/v2/viz/03ec7c7c-bc6a-11e4-b600-0e4fddd5de28/viz.json';
				// create cartoDB layer from vizjson url
				cartodb.createLayer(el.map, layerURL)
				.on('done', function(layer) {
		  			layer.setZIndex(100); // all cartoDB layer will be above all the baselayers
		  			var sublayer =layer.getSubLayer(0);
		  	   		el.landingSite = layer.createSubLayer({
		  	   			sql: "SELECT * FROM exomars_landing_sites_four",
		  				cartocss: '#exomars_landing_sites_four{marker-line-color: #FFF; marker-line-width: 0.5;  marker-line-opacity: 1;marker-placement: point;marker-type: ellipse;  marker-width: 7;marker-fill: #F00;  marker-allow-overlap: true;}'
		  	   		});
		  	   		el.latConstraint = layer.createSubLayer({
		  				sql: "SELECT * FROM lat_constraints",
		  				cartocss: '#lat_constraints{polygon-fill: #000000;polygon-opacity: 0.4;line-color: #f40202;line-width: 1;line-opacity: 1;}'
		  			});
		  			el.ellipses = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_corrected",
		  				cartocss: '#exomars_landing_sites_ellipses_corrected{line-color: #FFF; line-width: 1;line-opacity: 0;}'
 	  		    	});
 	  		    	el.ellipses1 = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_union WHERE id =1 ",
		  				cartocss: '#exomars_landing_sites_ellipses_union{line-color: #FCDC3B; line-width: 1;line-opacity: 1;}'
 	  		    	});
 	  		    	el.ellipses2 = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_union WHERE id = 2",
		  				cartocss: '#exomars_landing_sites_ellipses_union{line-color: #FCDC3B; line-width: 1;line-opacity: 1;}'
 	  		   		});
 	  		    	el.ellipses3 = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_union WHERE id =3",
		  				cartocss: '#exomars_landing_sites_ellipses_corrected{line-color: #FCDC3B; line-width: 1;line-opacity: 1;}'
 	  		    	});
 	  		    	el.ellipses4 = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_union WHERE  id = 4",
		  				cartocss: '#exomars_landing_sites_ellipses_union{line-color: #FCDC3B; line-width: 1;line-opacity: 1;}'
 	  		    	});
 	  		    	el.ellipses5 = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_union WHERE  id = 5",
		  				cartocss: '#exomars_landing_sites_ellipses_union{line-color: #00B2EE; line-width: 1;line-opacity: 1;}'
 	  		    	});
 	  		    	el.ellipses6 = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_union WHERE  id = 6",
		  				cartocss: '#exomars_landing_sites_ellipses_union{line-color: #00B2EE; line-width: 1;line-opacity: 1;}'
 	  		    	});
 	  		    	el.ellipses7 = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_union WHERE  id = 7",
		  				cartocss: '#exomars_landing_sites_ellipses_union{line-color: #00B2EE; line-width: 1;line-opacity: 1;}'
 	  		    	});
 	  		    	el.ellipses8 = layer.createSubLayer({
		  				sql: "SELECT * FROM exomars_landing_sites_ellipses_union WHERE  id = 8",
		  				cartocss: '#exomars_landing_sites_ellipses_union{line-color: #00B2EE; line-width: 1;line-opacity: 1;}'
 	  		    	});
 	  		    	
 	  		    	var base = el.basemap;
 	  		    	var baseColor = el.basemapColor;
 	  		    	var map = el.map;
		 			// define LayerAction to add or remove the layers
		  			el.LayerActions = {
		  				MOLA: function(){		
		  					if (map.hasLayer(base)){
		  						map.removeLayer(base);
		  					}else{
		  						map.addLayer(base)
		  					};
		  					if (map.hasLayer(baseColor)){
		  						map.removeLayer(baseColor);
		  					}else{
		  						map.addLayer(base)
		  					};
		  				},
						MOLA_color: function(){	  				
		  					if (map.hasLayer(baseColor)){
		  						map.removeLayer(baseColor);
		  					}else{
		  						map.addLayer(baseColor)
		  					};
		  					if (map.hasLayer(base)){
		  						map.removeLayer(base);
		  					}else{
		  						map.addLayer(baseColor)
		  					};	
						},
						hrscAram: function(){
		  					var hrscAram = el.hrsc[0];
		  					if (map.hasLayer(hrscAram)){
		  						map.removeLayer(hrscAram);
		  					}else{
		  						map.addLayer(hrscAram)
		  					};
		  				},
						hrscHypanis: function(){
		  					var hrscHypanis = el.hrsc[1];	
		  					if (map.hasLayer(hrscHypanis)){
		  						map.removeLayer(hrscHypanis);
		  					}else{
		  						map.addLayer(hrscHypanis)
		  					};
		  				},
						hrscOxia: function(){
		  					var hrscOxia = el.hrsc[2];	
		  					if (map.hasLayer(hrscOxia)){
		  						map.removeLayer(hrscOxia);
		  					}else{
		  						map.addLayer(hrscOxia)
		  					};
		  				},
						hrscMawrth: function(){
		  					var hrscMawrth = el.hrsc[3];
		  					if (map.hasLayer(hrscMawrth)){
		  						map.removeLayer(hrscMawrth);
		  					}else{
		  						map.addLayer(hrscMawrth)
		  					};
		  				},
		  				HiRISEOxia: function(){
		  					var HiRISEOxia = el.hirise[4];
		  					if (map.hasLayer(HiRISEOxia)){
		  						map.removeLayer(HiRISEOxia);
		  					}else{
		  						map.addLayer(HiRISEOxia)
		  					};
		  				},
		  				HiRISEMawrth: function(){
		  					var HiRISEMawrth = el.hirise[5];
		  					if (map.hasLayer(HiRISEMawrth)){
		  						map.removeLayer(HiRISEMawrth);
		  					}else{
		  						map.addLayer(HiRISEMawrth)
		  					};
		  				},		
		  				constraint1 : function() {
      						el.latConstraint.toggle();
      					},
    					ellipses: function(){
    						el.ellipses.toggle();
    					},
   						ellipses1: function(){
    						el.ellipses1.toggle();
    					},
     					ellipses2: function(){
    						el.ellipses2.toggle();
    					},
    					ellipses3: function(){
    						el.ellipses3.toggle();
    					},
    					ellipses4: function(){
    						el.ellipses4.toggle();
    					},
    					ellipses5: function(){
    						el.ellipses5.toggle();
    					},
    					ellipses6: function(){
    						el.ellipses6.toggle();
    					},
    					ellipses7: function(){
    						el.ellipses7.toggle();
    					},
    					ellipses8: function(){
    						el.ellipses8.toggle();
    					}
					}
					
		  			// hide layers when load the map element
		  			el.landingSite.hide();
		  			el.latConstraint.hide();
		  			el.ellipses.hide();
		  			el.ellipses1.hide();
		  			el.ellipses2.hide();
		  			el.ellipses3.hide();
		  			el.ellipses4.hide();
		  			el.ellipses5.hide();
					el.ellipses6.hide();
					el.ellipses7.hide();
					el.ellipses8.hide();
		  			// add cartoDB layers into the map
		  			el.map.addLayer(layer, false); 
		  		});
		 	} 
	  		// when you click a button, this(click) function will activate
  	  		$('.button').click(function() { // mouse event, when click button do something ( this something is inside the brackets)
  				$('.button').removeClass('selected'); // when click button  remove the class selected
  				$(this).addClass('selected'); // when click  button, add class selected
  				el.LayerActions[$(this).attr('id')](); // call LayerAction function and get the id attribute of the element
			}); // end of click event
	  		function click(el) {
      			var element = O.Core.getElement(el);
      			var t = O.Trigger();
      			function click() {
					t.trigger();
      			}
     			if (element) element.onclick = click;
	    			return t;
   			}
	  		// trigger a custom event called SlideChange
      		var emitSlideChange = O.Action( function() {
     			$(document).trigger('slideChange', function(){
      				trackCurrentSlide();
     			});
    		});  	
	  		// listen for the slideChange event to be triggered
      		function listenSlideChange() {
      			$(document).on('slideChange', function() {
					trackCurrentSlide();
      			});
    		}
      		// fire "this" each time the user changes a slide
      		function trackCurrentSlide(){
    			slides = $('#slides').children(); // creates an array of slides
    			slides.each(function(i){
    				if ($(this).hasClass('selected')){ 
        				checkIndex(i);
    				}
    			}); 
      		}
      		// check the index being returned by trackCurrentSlide()
      		function checkIndex(index) {
      			switch(index){
        			case 0: slideZero(); //overview
        			break;
        			case 1: slideOne(); // constraints
        			break;       
        			case 2: slideOne2(); // constraints
        			break;
        			case 3: slideOne3(); // constraints
        			break;
        			case 4: slideTwo(); // aram dorsum
        			break;
        			case 5: slideThree(); // aram dorsum
        			break
        			case 6: slideFour(); // Hypanis Vallis
        			break;
        			case 7: slideFive(); // Hypanis Vallis
        			break;
        			case 8: slideSix(); // Oxia Planum
        			break;
        			case 9: slideSeven(); // Oxia Planum
        			break;  
        			case 10: slideEight(); // Mawrth Vallis
        			break; 
        			case 11: slideNine(); // Mawrth Vallis
        			break; 
        			case 12: slideTen(); // End
        			break;     
      			};
   			 }
      		// overview
      		function slideZero() {
      			// only show landing sites
     			el.landingSite.hide();
     			el.latConstraint.hide();
    		};
	  		//overview with lat constraints
      		function slideOne() {      
    			//add the latitude constraint
    			el.landingSite.hide()
    			el.latConstraint.hide();
    			el.ellipses1.hide(); 
    		};
    		function slideOne2() {      
    			//add the latitude constraint
    			el.landingSite.show()
    			el.latConstraint.show();
    			el.ellipses1.hide(); 
    		};
    		function slideOne3() {      
    			//add the latitude constraint
    			el.landingSite.show()
    			el.latConstraint.show();
    			el.ellipses1.hide(); 
    		};
      		// Aram Dorsum 2018
      		function slideTwo() { 
     			el.latConstraint.hide();
	 			el.ellipses1.show();
	 			el.ellipses5.hide();
    		};
    		//Aram Dorsum 2020
    		function slideThree() {
	 			el.ellipses1.hide();
	 			el.ellipses2.hide();
	 			el.ellipses5.show();
    		};
      		// Hypanis Vallis 2018
      		function slideFour() {
	 			el.ellipses2.show();
	 			el.ellipses5.hide();
	 			el.ellipses6.hide();
    		};
    		// Hypanis Vallis 2020
      		function slideFive() {
	 			el.ellipses2.hide();
	 			el.ellipses3.hide();
	 			el.ellipses6.show();
    		};
      		// Oxia Planum 2018
      		function slideSix() {
	 			el.ellipses3.show();
	 			el.ellipses6.hide();
	 			el.ellipses7.hide();
    		};
    		// Oxia Planum 2020
      		function slideSeven() {
	 			el.ellipses3.hide();
	 			el.ellipses4.hide();
	 			el.ellipses7.show();
    		};
      		// Mawrth Vallis 2018
      		function slideEight() {
	 			el.ellipses4.show();
	 			el.ellipses7.hide();
	 			el.ellipses8.hide();
    		};
    		// Mawrth Vallis 2020
    		function slideNine() {
	 			el.ellipses4.hide();
	 			el.ellipses8.show();
    		};
      		// End of the story/overview
      		function slideTen() {
	 			el.ellipses8.hide();
    		};
      		function initOdyssey(O) {
      			// O is for Odyssey
      			var map = el.map;
      			var seq = O.Triggers.Sequential();
      			// enable keys to move slides
      			O.Triggers.Keys().left().then(seq.prev, seq)
      			O.Triggers.Keys().right().then(seq.next, seq)
      			// set up triggers for slide arrows 
      			click(document.querySelectorAll('.next')).then(seq.next, seq)
      			click(document.querySelectorAll('.prev')).then(seq.prev, seq)  
      			var slides = O.Actions.Slides('slides');
        		//setting setView here I assure that when the user zoom to a center or the landing sites
        		// coordinates, it will go to the coordinates
        		//There's a "bug" in leaflet that if you put panTo() and setZoom()
        		//it won't go to the coordinates requested
      			el.story =  O.Story()
        		.addState(
          			seq.step(0),
          				O.Parallel(       
            				el.map.actions.setView(el.center,3), 
							slides.activate(0),
            				emitSlideChange
          				)
        		)
        		// setting setView here I assure that if the user click prev button,
          		// it will show the overview 
        		.addState(
          			seq.step(1),
          				O.Parallel(
            				el.map.actions.setView(el.center,3), 
            				slides.activate(1),
            				emitSlideChange
          				)
        		)
        		.addState(
          			seq.step(2),
          				O.Parallel(
            				el.map.actions.setView(el.center,3), 
            				slides.activate(2),
            				emitSlideChange
          				)
        		)
        		.addState(
          			seq.step(3),
          				O.Parallel(
            				el.map.actions.setView(el.center,3), 
            				slides.activate(3),
            				emitSlideChange
          				)
        		)
        		// setview(coordinates to pan, zoom level, true: "reset the map view"(without animations of panning)) If true is not added, it will
        		// load the overlays that should disappear when the user change the slide. For example: if the minZoom it's 7 and the user change to
        		// a slide where the the minZoom is 5 it keeps the tile layer even if the layer minZoom is 7        
        		.addState(
          			seq.step(4),
          				O.Parallel(                        
            				el.map.actions.setView(el.Aram,10),
            				slides.activate(4),
            				emitSlideChange
          				)
        		)    
        		.addState(
          			seq.step(5),
          				O.Parallel(                        
            				el.map.actions.setView(el.Aram,10),
            				slides.activate(5),
            				emitSlideChange
          				)
        		)               
        		.addState(
          			seq.step(6),
          				O.Parallel(            
            				el.map.actions.setView(el.Hypanis,10),
            				slides.activate(6),
            				emitSlideChange         
          				)
        		)
        		.addState(
          			seq.step(7),
          				O.Parallel(            
            				el.map.actions.setView(el.Hypanis,10),
            				slides.activate(7),
            				emitSlideChange         
          				)
        		)
        		.addState(
          			seq.step(8),
          				O.Parallel(            
            				el.map.actions.setView(el.Oxia,10),
            				slides.activate(8),
            				emitSlideChange       
          				)
        		)
        		.addState(
          			seq.step(9),
          				O.Parallel(            
            				el.map.actions.setView(el.Oxia,10),
            				slides.activate(9),
            				emitSlideChange       
          				)
        		)
        		.addState(
          			seq.step(10),
          				O.Parallel(         
            				el.map.actions.setView(el.Mawrth,10),
            				slides.activate(10),
            				emitSlideChange       
          				)
        		)
        		.addState(
          			seq.step(11),
          				O.Parallel(         
            			el.map.actions.setView(el.Mawrth,10),
            			slides.activate(11),
            			emitSlideChange       
          				)
        		)                   
        		.addState(
          			seq.step(12),
          				O.Parallel(
            				el.map.actions.setView(el.center,3,true),
            				slides.activate(12),
            				emitSlideChange
            			)
          		)
      			el.story.go(0);
      		}  	
	  		function init() {
      			initMap();
      			cartodbData();
      			initOdyssey(O);
      			listenSlideChange();            
      		}
      		return {
      			init : init,
      		}			
  	})(window, document, jQuery,O);
	// 3. when the document has been completely loaded and parsed it applies the function to the window element  
	window.addEventListener("DOMContentLoaded", function(){
    	app.exomars.init();
  });
</script>	
</body>
</html>		
		
		